using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Calcularoa_C_S2_Tr1.Modelos;

namespace Calcularoa_C_S2_Tr1.Controladores
{
 public class Controlador_calculadora
 {
 private readonly Calculadora calculadora_obj = new Calculadora();

 // Calcula el resultado respetando precedencia: primero * y /, luego + y -
 public decimal CalculateResult(Guardar_numero_signo data)
 {
 if (data == null)
 throw new ArgumentNullException(nameof(data));

 // Trabajar sobre copias para no mutar el modelo original
 var numeros = new List<decimal>(data.Numbers);
 var operadores = new List<char>(data.Operators);

 // Primero multiplicaciones y divisiones
 for (int idx =0; idx < operadores.Count; idx++)
 {
 if (operadores[idx] == '*' || operadores[idx] == '/')
 {
 decimal valor_a = numeros[idx];
 decimal valor_b = numeros[idx +1];
 decimal resultado;

 if (operadores[idx] == '*')
 resultado = calculadora_obj.Multiply(valor_a, valor_b);
 else
 resultado = calculadora_obj.Divide(valor_a, valor_b); // puede lanzar DivideByZeroException

 numeros[idx] = resultado;
 numeros.RemoveAt(idx +1);
 operadores.RemoveAt(idx);
 idx--; // retroceder índice para reevaluar en la nueva posición
 }
 }

 // Luego sumas y restas
 for (int idx =0; idx < operadores.Count; idx++)
 {
 if (operadores[idx] == '+' || operadores[idx] == '-')
 {
 decimal valor_a = numeros[idx];
 decimal valor_b = numeros[idx +1];
 decimal resultado;

 if (operadores[idx] == '+')
 resultado = calculadora_obj.Add(valor_a, valor_b);
 else
 resultado = calculadora_obj.Subtract(valor_a, valor_b);

 numeros[idx] = resultado;
 numeros.RemoveAt(idx +1);
 operadores.RemoveAt(idx);
 idx--;
 }
 }

 return numeros.Count >0 ? numeros[0] :0m;
 }
 }
}
